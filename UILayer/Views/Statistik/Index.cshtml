@{
    ViewData["Title"] = "Anlık İstatistikler";
    Layout = "~/Views/Admin/Index.cshtml";
}

<h4 class="page-title">Anlık İstatistikler</h4>
<div class="row">
    <div class="col-md-3">
        <div class="card card-stats card-warning">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-tags"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Kategori Sayısı</p>
                            <h4 class="card-title" id="categoryCounter">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-success">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-check"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Aktif Kategori</p>
                            <h4 class="card-title" id="activeCategoryCounter">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-danger">
            <div class="card-body">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-ban"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Pasif Kategori</p>
                            <h4 class="card-title" id="passiveCategoryCounter">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-primary">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-cogs"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Ürün Sayısı</p>
                            <h4 class="card-title" id="activeProductCounter">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-3">
        <div class="card card-stats card-warning">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-support"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Hamburger Sayısı</p>
                            <h4 class="card-title" id="hamburgerCounter">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-success">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-coffee"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">İçecek Sayısı</p>
                            <h4 class="card-title" id="drinkCounter">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-danger">
            <div class="card-body">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-dollar"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Ürün Ortalama Fiyat</p>
                            <h4 class="card-title" id="productPriceAvg">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-primary">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-star"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">En Pahalı Ürün</p>
                            <h4 class="card-title" id="maxPriceProductName">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-3">
        <div class="card card-stats card-warning">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-tag"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">En Ucuz Ürün</p>
                            <h4 class="card-title" id="minPriceProductName">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-success">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-balance-scale"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Ortalama Hamburger Fiyatı</p>
                            <h4 class="card-title" id="avgHamburgerPrice">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-danger">
            <div class="card-body">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Toplam Sipariş</p>
                            <h4 class="card-title" id="totalOrderCount">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-primary">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-check-circle"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Aktif Sipariş Sayısı</p>
                            <h4 class="card-title" id="activeOrderCount">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-3">
        <div class="card card-stats card-warning">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-users"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Son Sipariş Tutarı</p>
                            <h4 class="card-title" id="lastOrderPrice">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-success">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-credit-card"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Kasadaki Tutar</p>
                            <h4 class="card-title" id="moneyCaseAmount">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-danger">
            <div class="card-body">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-calendar"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Bugünkü Kazanç</p>
                            <h4 class="card-title" id="todayTotalPrice">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-stats card-primary">
            <div class="card-body ">
                <div class="row">
                    <div class="col-5">
                        <div class="icon-big text-center">
                            <i class="la la-table"></i>
                        </div>
                    </div>
                    <div class="col-7 d-flex align-items-center">
                        <div class="numbers">
                            <p class="card-category">Masa Sayısı</p>
                            <h4 class="card-title" id="tableCount">***</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>

<script type="text/javascript">
    $(document).ready(() => {
        // SignalR bağlantısı oluştur
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("https://localhost:7068/SignalRHub")
            .build();

        // Başlangıç durumu
        $("#connstatus").text(connection.state);

        // Bağlantı başlatma
        connection.start()
            .then(() => {
                $("#connstatus").text("Bağlantı kuruldu");
                setInterval(() => {
                    connection.invoke("SendStatistics");
                }, 1000);
            })
            .catch((err) => {
                $("#connstatus").text("Bağlantı hatası");
                console.error(err.toString());
            });

        // Bağlantı durum değişikliklerini dinle
        connection.onclose(() => {
            $("#connstatus").text("Bağlantı kapalı");
        });

        connection.on("ReceiveCategoryCount",(value)=>{
            $("#categoryCounter").text(value);
        });
        connection.on("ReceiveActiveCategoryCount",(value)=>{
            $("#activeCategoryCounter").text(value);
        });
        connection.on("ReceivePassiveCategoryCount",(value)=>{
            $("#passiveCategoryCounter").text(value);
        });
        connection.on("ReceiveActiveProductCount",(value)=>{
            $("#activeProductCounter").text(value);
        });
        connection.on("ReceiveProductCountByCategoryNameHamburger",(value)=>{
            $("#hamburgerCounter").text(value);
        });
        connection.on("ReceiveProductCountByCategoryNameDrink",(value)=>{
            $("#drinkCounter").text(value);
        });
        connection.on("ReceiveProductPriceAvg",(value)=>{
            $("#productPriceAvg").text(value);
        });
        connection.on("ReceiveMaxPriceProductName",(value)=>{
            $("#maxPriceProductName").text(value);
        });
        connection.on("ReceiveMinPriceProductName",(value)=>{
            $("#minPriceProductName").text(value);
        });
        connection.on("ReceiveAvgHamburgerPrice",(value)=>{
            $("#avgHamburgerPrice").text(value);
        });
        connection.on("ReceiveTotalOrderCount",(value)=>{
            $("#totalOrderCount").text(value);
        });
        connection.on("ReceiveActiveOrderCount",(value)=>{
            $("#activeOrderCount").text(value);
        });
        connection.on("ReceiveLastOrderPrice",(value)=>{
            $("#lastOrderPrice").text(value);
        });
        connection.on("ReceiveMoneyCaseAmount",(value)=>{
            $("#moneyCaseAmount").text(value);
        });
        connection.on("ReceiveTodayTotalPrice",(value)=>{
            $("#todayTotalPrice").text(value);
        });
        connection.on("ReceiveTableCount",(value)=>{
            $("#tableCount").text(value);
        });
    });
</script>
